 

# 1 mysql的几种引擎，他们中的区别

特性	InnoDB	MyISAM	MEMORY
事物安全	支持	不支持	不支持
对外建的支持	支持	不支持	不支持
存储限制	64TB	有	有
空间使用	高	低	低
内存使用	高	低	高
插入数据的速度	低	高	高
InnoDB是Mysql的默认存储引擎(Mysql5.5.5之前是MyISAM

当需要使用数据库事务时候，InnoDb就是首选
由于锁的粒度小，写操作是不会锁定全表的。所以在并发度较高的场景下使用会提升效率的。
大批量的插入语句时（这里是INSERT语句）在MyIASM引擎中执行的比较的快，但是UPDATE语句在Innodb下执行的会比较的快，尤其是在并发量大的时候。
为什么要使用自增主键

在业务中，主键最好是设置一个与业务无关的自增id作为主键，然后添加一个与业务有关的字段作为唯一性约束（要求该列唯一，允许为空，但只能出现一个空值）
要是使用自增主键，每次插入新的记录，记录就会索引到当前索引节点的位置，直接添加，要是一业务写满，就自动开辟一个新的页，总而言之就是提高查询和写入的速度
如果通过非系统增加记录时，可以不用指定该字段，不用担心主键重复问题
要是我随机生成一个UUid进去会怎么样

因为innoDB是在索引中存储索引值，也是在叶子节点中存储数据，所以没有定义主要就会使用一个非空的键作为主键聚簇索引中，N行形成一个页（16k），要是有不规则的数据插入时为了保存b+树的平衡，会造成频繁的页分裂和页旋转，插入速度就变慢，所以聚簇索引的注解银根是连续增长的值

# 2 mysql的索引

## 2.1 什么时候索引能生效

1 where 等值 范围

2 group by

3 oder by

4 join

# 2.2 索引失效的情况
1 以%开头的like查询
2 隐式转换时，当列类型是字符串时候，要是where查询时候没有引起来，就也不会走索引
3 复合索引情况下不满足最左原则Leftmost,也不会使用复合索引。
4 如果MySQL估计使用索引比全表扫描更慢，则不使用索引。
5  困难谓词  以or分割开的条件，如果or前的条件列中有索引，而后面的列中没有索引，那么涉及的索引都不会被用到。因为or后面的条件列中没有索引，那么后面的查询肯定要走全表扫描，在存在全表扫面的情况下，就没有必要多一次索引扫面增加I/O访问，一次全表扫描过滤条件就足够了。

## 2.3 MySQL的最左匹配原则，不能是中间匹配，最右匹配

**最左匹配原则：**最左优先，以最左边的为起点任何连续的索引都能匹配上。同时遇到范围查询(>、<、between、like)就会停止匹配。

比如a，b建立索引时候，是先以a建立的索引，此时b是无序的，在以a建立之后的a的子树上再建立b的索引，所以对于整颗b+树来说，a是一定有序的，b是不一定有序的

当b+树的数据项是复合的数据结构，比如(name,age,sex)的时候，b+数是按照从左到右的顺序来建立搜索树的，比如当(张三,20,F)这样的数据来检索的时候，b+树会优先比较name来确定下一步的所搜方向，如果name相同再依次比较age和sex，最后得到检索的数据；但当(20,F)这样的没有name的数据来的时候，b+树就不知道下一步该查哪个节点，因为建立搜索树的时候name就是第一个比较因子，必须要先根据name来搜索才能知道下一步去哪里查询。比如当(张三,F)这样的数据来检索时，b+树可以用name来指定搜索方向，但下一个字段age的缺失，所以只能把名字等于张三的数据都找到，然后再匹配性别是F的数据了， 这个是非常重要的性质，即索引的最左匹配特性。

## 2.4 mysql怎么实现主从复制

Master开启bin-log功能，服务器配置二进制日志（binlog日志），只保留update等的数据。
需要开启三个线程，Master：I/O线程；Slave：I/O线程，SQL线程。
从数据库会请求主数据库的binlog日志，将bin-log日志内容写入到relay-log中继日志，创建一个master.info文件，然后按日志执行
Slave已经开启了sql线程，由sql线程实时监测relay-log日志内容是否有更新，如果有更新，则解析文件中的sql语句，并在Slave数据库中执行相同的操作语句。

## 2.5 主从复制延迟

1 主库压力大

2 DDL

3 大事物

4 从库提供查询能力，竞争锁

5 从库自身压力过大
【原因分析】
从库执行大量select请求，或业务大部分select请求被路由到从库实例上，甚至大量OLAP业务，或者从库正在备份等。
此时可能造成cpu负载过高，io利用率过高等，导致SQL Thread应用过慢。产生的DDL数量超过slave一个sql线程所能承受的范围，那么延时就产生了，当然还有就是可能与slave的大型query语句产生了锁等待

6 表缺乏主键或唯一索引
binlog_format=row的情况下，如果表缺乏主键或唯一索引，在UPDATE、DELETE的时候可能会造成从库延迟骤增。
此时Slave_SQL_Running_State为Reading event from the relay log。
并且SHOW OPEN TABLES WHERE in_use=1的表一直存在。
Exec_Master_Log_Pos不变。
mysqld进程的cpu几近100%（无读业务时），io压力不大

【原因分析】
做个极端情况下的假设，主库更新一张500w表中的20w行数据，该update语句需要全表扫描
而row格式下，记录到binlog的为20w次update操作，此时SQL Thread重放将特别慢，每一次update可能需要进行一次全表扫描

# 3 死锁

# 4 MMVC

# 5  lsm tree 

# 6 数据库三范式

# 7 分别说一下范式和反范式的优缺点

# 8 为什么 B+ 树比 B 树更适合应用于数据库索引，除了数据库索引，还有什么地方用到了（操作系统的文件索引

B+ 树和 B 树的区别？
B 树非叶子结点和叶子结点都存储数据,因此查询数据时，**时间复杂度最好为 O(1),最坏为 O(log n)**。
B+ 树只在叶子结点存储数据，非叶子结点存储关键字，且不同非叶子结点的关键字可能重复，因此查询数据时，时间复杂度固定为 O(log n)。

B+ 树叶子结点之间用链表相互连接，因而只需扫描叶子结点的链表就可以完成一次遍历操作，B树只能通过中序遍历。
为什么 B+ 树比 B 树更适合应用于数据库索引？
**B+ 树更加适应磁盘的特性，相比 B 树减少了 I/O 读写的次数**。由于索引文件很大因此索引文件存储在磁盘上，B+ 树的非叶子结点只存关键字不存数据，因而单个页可以存储更多的关键字，即一次性读入内存的需要查找的关键字也就越多，磁盘的随机 I/O 读取次数相对就减少了。

B+ 树的查**询效率相比B树更加稳定**，由于数据只存在在叶子结点上，所以查找效率固定为 O(log n)。

B+ 树叶子结点之间用链表有序连接，所以扫描全部数据只需扫描一遍叶子结点，利于**扫库和范围查询**；B 树由于非叶子结点也存数据，所以只能通过中序遍历按序来扫。也就是说，对于范围查询和有序遍历而言，B+ 树的效率更高。



















聚簇索引和非聚簇索引
前缀索引和覆盖索引

# 10 介绍一下数据库的事务

# 11 Mysql 有哪些隔离级别

Mysql 什么情况会造成脏读、可重复度、幻读？如何解决
Mysql 在可重复度的隔离级别下会不会有幻读的情况，为什么？

# 12 Mysql 事务是如何实现的

# 13 Binlog 和 Redo log 的区别是什么，分别是什么用？

# 14 Innodb 的默认加锁方式是什么，是怎么实现的

# 15 如何高效处理大库 DDL

# 16 Mysql 索引重建

# 17 对于多列索引，哪些情况下能用到索引，哪些情况用不到索引

# 18 为什么使用数据库索引可以提高效率，在什么情况下会用不到数据库索引？

# 19 共享锁和排他锁的使用场景

# 20 关系型数据库和非关系数据库的优缺点
# 21 Mysql 什么情况会造成慢查，如何查看慢查询

如何处理慢查询，你一般是怎么处理慢查询的

# 21 Mysql 中 varchar 和 char 的区别

# 22 数据库外键的优缺点

有没有使用过数据库的视图

# 23 Mysql 中插入数据使用自增 id 好还是使用 uuid，为什么？

# 24 Mysql 有哪些数据类型，使用的时候有没有什么注意点

# 25 Mysql 集群有哪几种方式，分别适用于什么场景

# 26 Mysql 主从模式如何保证主从强一致性

# 27 Mysql 集群如何保证主从可用性

# 28 Mysql 读写分离有哪些解决办法

 # 29 MySQL drop delete truncate 区别



# 30 MySQL tblScore 学生总成绩大于 200 的uid 表结构：(id,uid,subjectId,score) 

\1. uid int 类型索引

where uid=123 能命中索引吗

where uid='123'  能命中索引吗



# 31  mysql 如何优化？

# 32  如何创建索引，需要注意什么

 

# 33 . 为什么不用 红黑树？

# 34 . 联合索引要注意什么？

MySQL 索引类型？主键索引和其他普通索引的区别？联合索引？哪些情况下可以不用回表？索引的底层结构



一个表 user_id,order_date,要查用户订单,某一天订单,某个用户某天订单,如何建索引 

复合索引的结构



IN 是否参与索引

MySQL 

有哪些锁 

索引什么时候不生效



MySQL 如何避免幻读 

MySQL 锁机制是怎样的 

如果避免、减少锁等待、团队中如何监控 MySQL 的锁等待的情况



mysql 存储引擎有哪些

# A 给 B 转账，如何保证事务？ 



A 给 B 转账，同时 B 给 A 转账，会出现什么问题？（死锁，详细阐述了实际操作时不会产 

生的，锁机制） 

A 给 B 转账，同时 B 给 A 转账，如何避免死锁（不考虑数据库锁机制，自己实现）？说了 

一些，面试官说沾边了，但是最终没有回答上

# mysql  索引的实现方式 mysql 查询一条记录需要查几次磁盘（最后一点查磁盘没回答上来）

# 写入一条数据的过程

# mysql中数据量太大，怎么对数据库做优化，比如一天50万数据的情况下怎么设计数据库



. 如果用用户手机号当主键有什么不合理的地方? 想多少说多少.想到没有想法的时候终 止

如果有两个字段 a 和 b.要进行查询.怎么考虑建立索引? 如果用 a 和 b 查询的多.也会用到 

b 查询.怎么建立索引?

用自己的话说说 inner join 和 left join.



mysql 内部主键的原理，自定义主键与自增主键的优缺点

回表操作是什么，回表最大次数，如何减少回表操作，意向锁的作 

用是啥，行锁有哪些，间隙锁如何防止幻读



mysql 索引结构，为什么用 B+树不用红黑树



有一张表其中俩字段 A,B,创建 A、B 的联合索引 KEY idx (A,B) 

select * from table where B = 1 会命中索引吗？为什么？





线上生产环境中，如何实时迁移 mysql 及到一个容量更大的 mysql



.sql 学生教师课程成绩表 求平均成绩>=60 分的学生的 id, 姓名，平均成绩（是后面学生的 

平均成绩）

sno subject score 

1001 

语文 

60 

1001 

数学 

40 

1002 

语文 

30 

写个 sql 查语文及格但数学没及格的



 |nodename|success| 

其中 nodename 代表节点名字，success：0 失败，1 成功 

a,1 

a,1 

a,1 

a,1 

b,1 

b,0 

用一行 sql 得到按节点统计执行成功率，得到如下结果 

a,1.0 

b,0.5



sql 题目: 学生表,教师表,课程表,成绩表. 查询平均成绩大于 60 分的学生姓名,id,平均分 

数

.**面试经验四十四** 

 

\3. mysql insert 和 update 是行锁还是表锁 

\4. mysql 引擎区别 

\5. 

未用到索引的情况



聚簇索引和非聚簇索引的区别。 

\3. 

主键索引和普通索引的区别



何抉择什么情况下对 mysql 建索引，你是如何优化的

分库分表 查询问题

 

4.Mysql 索引原理，索引分类，各种锁，事务隔离级别，幻读，不可重复读，MVCC，联合 

索引。



innodb 行锁和间隙锁是怎么实现的，在什么时候加锁

后台页面发出一个请求的时候，到达你的服务里面。具体是什么流程，有哪些要点要 

注意的 



 MySQL做过哪些优化？覆盖索引？limit两个参数区别？MySQL分页优化的其他方法 

 查字典是什么索引？ 

mysql 索引使用时注意什么？or 索引失效，那怎么办

Mysql 集群在保证强一致性的情况下，如何保证高并发。聊了好多种方法，但是面试官都不是很满意，中间磕磕绊绊的。最后问可不可以用缓存，我前面提到了使用 redis 中间做一层，但是面试官说用 memcache

 mysql 的 qps 是多大，如何避免 qps 大造成的宕机，如何设计压测计算 mysql 的 qps

.mysql 一定要设置主键 id 么，不设置主键 id 时 mysql 如何处理

